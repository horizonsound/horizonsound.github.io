{% comment %}
UNIFIED CAROUSEL COMPONENT
Supports:
- playlist pages (mode="playlist")
- song pages (mode="song")
- public_only=true/false
- current = currently active song object
- songs = list of song_ids OR list of song objects
{% endcomment %}

{% assign mode = include.mode | default: "playlist" %}
{% assign public_only = include.public_only | default: false %}
{% assign current = include.current %}
{% assign songs = include.songs %}

<div class="playlist-carousel">

  <!-- LEFT ARROW -->
  <button class="carousel-arrow left-arrow">‹</button>

  <!-- SCROLLING STRIP -->
  <div class="horizontal-strip">
    {% for item in songs %}

      {%- comment -%}
      Normalize item → always get a full song object
      {%- endcomment -%}

      {% if item.song_id %}
        {% assign song = item %}
      {% else %}
        {% assign song = site.songs | where: "song_id", item | first %}
      {% endif %}

      {% assign url = "/music/" | append: song.song_id | append: "/" %}
      {% assign meta = site.data.music.songs | where: "url", url | first %}

      {%- comment -%}
      Public-only filtering
      {%- endcomment -%}
      {% if public_only and meta.videostatus != "Public" %}
        {% continue %}
      {% endif %}

      {%- comment -%}
      Determine active tile
      {%- endcomment -%}
      {% assign is_active = false %}
      {% if current and current.song_id == song.song_id %}
        {% assign is_active = true %}
      {% endif %}

      <div class="playlist-tile {% if is_active %}active-tile{% endif %}"
           data-song="{{ song.song_id }}"
           data-url="{{ url }}">
        <img src="{{ meta.image }}" alt="{{ song.title }}">
        <h3 class="tile-title">{{ song.title }}</h3>
      </div>

    {% endfor %}
  </div>

  <!-- RIGHT ARROW -->
  <button class="carousel-arrow right-arrow">›</button>

</div>
